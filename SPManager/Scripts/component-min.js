!function(e,t,n){var a={selectMod:1,selectIds:[],extraParams:{},callback:null},i={selectGoods:e("#tpl_popup_selectGoods").html()},o=null,s={},l={getItem:"/Design/getItem"},c=function(t,n,a){e.ajax({url:l.getItem+"?v="+Math.round(100*Math.random()),type:"POST",dataType:"json",data:e.extend({},a,n.extraParams),beforeSend:function(){e.jBox.showloading()},success:function(l){if(1==l.status){o=l.list;var c=_.template(i.selectGoods,{dataset:l.list,classlists:l.class_lists,store_list:l.store_list,page:l.page,formdata:a,selectMod:n.selectMod,selectIds:n.selectIds,curPageCache:s[a.p]});console.log(l),$render=e(c),t.find(".jbox-container").empty().html($render)}else HYD.hint("danger","获取数据失败，"+l.msg),e.jBox.close(t);e.jBox.hideloading()}})},r=function(e){var t=e.attr("href");if(t.length){var n=t.split("/"),a=n[n.length-1].replace(/.html/,"");return a}};_QV_="%E6%9D%AD%E5%B7%9E%E5%90%AF%E5%8D%9A%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89",e.selectGoods=function(t){var n=e.extend(!0,{},a,t);o=null,s={},e.jBox.show({title:"选择商品",width:1e3,minHeight:605,content:"",onOpen:function(t){c(t,n,e.extend({},{p:1},n.extraParams));var a=function(){var n=t.find(".paginate a.cur").text(),a=[],i=[];t.find(".j-chkbox:checked").each(function(){var t=e(this),n=t.data("itemid"),s=t.data("index"),l=o[s];a.push(n),i.push(l)}),s[n]={ids:a,data:i}};t.on("click",".paginate a",function(){if(!e(this).hasClass("cur")){a();var i=r(e(this)),o=t.find("input[name=title]").val(),s=t.find("select[name=status]").val(),l=t.find("select[name=class_id]").val(),d=t.find('select[name="merchant_shop_id"]').val();return c(t,n,e.extend({},{p:i,title:o,status:s,class_id:l,merchant_shop_id:d},n.extraParams)),!1}}),t.on("click",".j-search",function(){var a=t.find("input[name=title]").val(),i=t.find("select[name=status]").val(),o=t.find("select[name=class_id]").val(),s=t.find('select[name="merchant_shop_id"]').val();c(t,n,e.extend({},{p:1,title:a,status:i,class_id:o,merchant_shop_id:s},n.extraParams))}),1==n.selectMod?t.on("click",".j-select",function(){var a=e(this).data("index");n.callback&&n.callback(o[a]),e.jBox.close(t)}):(t.on("click",".j-select",function(){var t=e(this),n=t.siblings(".j-chkbox");t.hasClass("cur")?(t.removeClass("cur"),n.attr("checked",!1)):(t.addClass("cur"),n.attr("checked",!0))}),t.on("click",".j-use",function(){a();var i=[],o=[];for(var l in s)i=i.concat(s[l].ids),o=o.concat(s[l].data);n.callback&&n.callback(o,i),e.jBox.close(t)}),t.on("click",".j-selectAll",function(){t.find(".j-select").addClass("cur"),t.find(".j-chkbox").attr("checked",!0)}),t.on("click",".j-selectReverse",function(){t.find(".j-select").each(function(){var t=e(this),n=t.siblings(".j-chkbox");t.hasClass("cur")?(t.removeClass("cur"),n.attr("checked",!1)):(t.addClass("cur"),n.attr("checked",!0))})}),t.on("click",".j-cancelSelectAll",function(){t.find(".j-select").removeClass("cur"),t.find(".j-chkbox").attr("checked",!1)}))},btnOK:{show:!1},btnCancel:{show:!1}})}}(jQuery,document,window),$(function(){var e=null,t=null,n=null,a={content:"",callback:null};$.composeBox=function(i){var o=$.extend(!0,{},a,i),s=$("#tpl_popup_selectCompose").html(),l=$(s);$("body").append(l);var c=($(".J-composeBox").height(),$(window).height());$("body").append('<div class="box-overlay"></div>'),$(".box-overlay").css("height",c);var r=$(window).height(),d=$(".compose_top").height(),p=$("#tmpl h2").height(),u=r-d-p;l.find(".compose_lists").css({height:u,overflow:"auto"});var g=function(){$(".J-composeBox").remove(),$(".box-overlay").remove(),$("body").css({height:"auto",overflow:"auto"})};renderData(l,"10"),l.on("click",".J-okClk",function(){o.content=e.getContent(),t=o.content,n=html_encode(o.content),o.callback&&o.callback(t,n),g(),e.destroy()}),l.on("click",".J-noClk",function(){g(),e.destroy()}),l.find("#nav li").click(function(){var e=$(this),t=e.data("id");e.addClass("active").siblings().removeClass("active"),renderData(l,t)}),l.on("click",".compose_lists li",function(){var t=$(this).find(".pEditor").html()+"<p></p>";e.focus(),e.execCommand("inserthtml",t)}),e=UE.getEditor("edit_content",{autoHeight:!1,autoHeightEnabled:!1,autoClearinitialContent:!1,initialFrameHeight:u-74}),e.ready(function(){e.setContent(o.content)})},_QV_="%E6%9D%AD%E5%B7%9E%E5%90%AF%E5%8D%9A%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89",renderData=function(e,t){$.ajax({url:"/Public/mockdata/composedata/dataset"+t+".json?v="+Math.round(100*Math.random()),type:"GET",dataType:"json",beforeSend:function(){$.jBox.showloading()},success:function(t){if(1==t.status){var n=$("#tpl_Compose_lists").html(),a=_.template(n,{dataset:t.data}),i=$(a);$("#tmpl .compose_lists").empty().append(i)}else HYD.hint("danger","获取数据失败，"),$.jBox.close(e);$.jBox.hideloading()}})},html_encode=function(e){var t="";return 0==e.length?"":(t=e.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"&#39;"),t=t.replace(/\"/g,"&quot;"))},html_decode=function(e){var t="";return 0==e.length?"":(t=e.replace(/&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&nbsp;/g," "),t=t.replace(/&#39;/g,"'"),t=t.replace(/&quot;/g,'"'))}});var HYD=HYD?HYD:{};HYD.Constant=HYD.Constant?HYD.Constant:{},HYD.popbox=HYD.popbox?HYD.popbox:{},HYD.linkType={1:"首页",3:"商品列表",6:"我的",7:"套餐列表",11:"拨打电话",14:"门店列表",16:"地图导航",17:"购物车",22:"专题页面",23:"专题列表",24:"在线买单"},HYD.getTimestamp=function(){var e=new Date;return""+e.getFullYear()+parseInt(e.getMonth()+1)+e.getDate()+e.getHours()+e.getMinutes()+e.getSeconds()+e.getMilliseconds()},HYD.hint=function(e,t,n){if(e&&t){var a=$("#tpl_hint").html(),i=_.template(a,{type:e,content:t}),o=$(i),s=200,n=n||1500;$("body").append(o.css({opacity:"0",zIndex:"999999"})),o.animate({opacity:1,top:200},s,function(){setTimeout(function(){o.animate({opacity:0,top:600},s,function(){$(this).remove()})},n)})}},HYD.FormShowError=function(e,t,n){e&&t&&(void 0==n&&(n=!0),e.addClass("error").siblings(".fi-help-text").addClass("error").text(t).show(),n&&e.focus(),"select"==e[0].nodeName.toLowerCase()&&e.siblings(".select-sim").addClass("error"),e.one("change",function(){HYD.FormClearError($(this))}))},HYD.FormClearError=function(e){e&&(e.removeClass("error").siblings(".fi-help-text").hide(),"select"==e[0].nodeName.toLowerCase()&&e.siblings(".select-sim").removeClass("error"))},HYD.showQrcode=function(e){var t=$("#qrcode");if(!t.length){var n=_.template($("#tpl_qrcode").html(),{src:e});t=$(n),t.click(function(){t.fadeOut(300)}),$("body").append(t)}t.find("img").attr("src",e),t.fadeIn(300)},HYD.changeWizardStep=function(e,t){var n=$(e),a=n.find(".wizard-item");a.removeClass("process complete");for(var i=0;i<=t-1;i++)a.filter(":eq("+i+")").addClass("complete");a.filter(":eq("+t+")").addClass("process")},HYD.autoLocation=function(e,t){if(e){var t=t?t:2e3;timer=setInterval(function(){t<=1e3?(clearInterval(timer),window.location.href=e):(t-=1e3,$("#j-autoLocation-second").text(t/1e3))},1e3)}},HYD.ajaxPopTable=function(e){var t,n,a={title:"",url:"",data:{p:1},tpl:"",onOpen:null,onPageChange:null},i=$.extend(!0,{},a,e),o=$("<div></div>"),s=function(e){var a=i.tpl,l=i.url,c=function(l){t=l;var c=_.template(a,l),r=$(c);o.empty().append(r),o.find(".paginate a:not(.disabled,.cur)").click(function(){for(var e=$(this).attr("href"),t=e.split("/"),n=0;n<t.length;n++)if("p"==t[n]){i.data.p=t[n+1],s();break}return!1}),e&&e(),i.onPageChange&&i.onPageChange(n,t)};$.ajax({url:l+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:i.data,success:function(e){1==e.status?c(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})};s(function(){$.jBox.show({title:i.title,content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){n=e,i.onOpen&&i.onOpen(e,t)}})})},HYD.popbox.ImgPicker=function(e){var t,n=$("#tpl_popbox_ImgPicker").html(),a=$(n),i=function(e,n){var o=function(e){if(t=e.list,t&&t.length){var o=_.template($("#tpl_popbox_ImgPicker_listItem").html(),{dataset:t}),s=$(o);s.filter("li").click(function(){$(this).toggleClass("selected")}),a.find(".imgpicker-list").empty().append(s);var l=e.page,c=$(l);c.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),i(t),!1}),a.find(".paginate").empty().append(c)}else a.find(".imgpicker-list").append("<p class='txtCenter'>对不起，暂无图片</p>");n&&n()};$.ajax({url:"/Design/getImg?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?o(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},o=function(t){var n=[];a.find("#imgpicker_upload_input").uploadify({debug:!1,auto:!0,formData:{PHPSESSID:$.cookie("PHPSESSID")},width:60,height:60,multi:!0,swf:"/Public/plugins/uploadify/uploadify.swf",uploader:"/Design/uploadFile",buttonText:"+",fileSizeLimit:"5MB",fileTypeExts:"*.jpg; *.jpeg; *.png; *.gif; *.bmp",onSelectError:function(e,t,n){switch(t){case-100:HYD.hint("danger","对不起，系统只允许您一次最多上传10个文件");break;case-110:HYD.hint("danger","对不起，文件 ["+e.name+"] 大小超出5MB！");break;case-120:HYD.hint("danger","文件 ["+e.name+"] 大小异常！");break;case-130:HYD.hint("danger","文件 ["+e.name+"] 类型不正确！")}},onFallback:function(){HYD.hint("danger","您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试。")},onUploadSuccess:function(e,t,i){var t=$.parseJSON(t),o=$("#tpl_popbox_ImgPicker_uploadPrvItem").html(),s=a.find(".imgpicker-upload-preview"),l=t.file_path;n.push(l);var c=_.template(o,{url:l}),r=$(c);r.find(".j-imgpicker-upload-btndel").click(function(){var e=a.find(".imgpicker-upload-preview li").index($(this).parent("li"));r.fadeOut(300,function(){n.splice(e,1),$(this).remove()})}),s.append(r)},onUploadError:function(e,t,n,a){HYD.hint("danger","对不起："+e.name+"上传失败："+a)}}),a.find("#j-btn-uploaduse").click(function(){e&&e(n),$.jBox.close(t)})};i(1,function(){$.jBox.show({title:"选择图片",content:a,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(n){var i=a.find("#j-btn-listuse");i.click(function(){var i=[];a.find(".imgpicker-list li.selected").each(function(){i.push(t[$(this).index()])}),e&&e(i),$.jBox.close(n)}),a.find(".j-initupload").one("click",function(){o(n)})}})})},HYD.popbox.IconPicker=function(e){var t,n=$("#icon_imgPicker").html(),a=$(n);t=$.browser.chrome?"body":document.documentElement||document.body,$(t).append(a);var i=$("#icon_imglist").html(),o={style:"style1",color:"color0"},s=function(e){o=e?e:o;var t=_.template(i,{data:HYD.popbox.iconimgsrc.data[o.style][o.color]});a.find(".albums-icon-tab").html(t),a.find(".albums-icon-tab").find("li").click(function(e){var t=$(this);t.hasClass("selected")||t.addClass("selected").siblings("li").removeClass("selected")})};s(o),a.find(".albums-cr-actions").children("a").click(function(e){var t=$(this),n=t.data("style");o.style=n,t.addClass("cur").siblings("a").removeClass("cur"),s(o)}),a.find(".albums-color-tab").find("li").click(function(e){var t=$(this),n=t.data("color");o.color=n,t.addClass("cur").siblings("li").removeClass("cur"),s(o)});var l=[];a.find("#j-useIcon").click(function(t){var n=a.find(".albums-icon-tab").find("li.selected");if(0==n.length)return HYD.hint("danger","对不起，请选择一张小图标"),!1;var i=n.children("img").attr("src");i=i.replace("Public","PublicMob"),l.push(i),c(),e&&e(l)});var c=function(){a.remove()};a.find("#Jclose").click(function(e){c()})},HYD.popbox.ModulePicker=function(e){var t,n=$("#tpl_popbox_ModulePicker").html(),a=$(n),i=function(e,n){var o=function(e){if(t=e.list,t&&t.length){var o=$("#tpl_popbox_ModulePicker_item").html(),s=_.template(o,{dataset:t}),l=$(s);a.find(".modulePicker-list").empty().append(l);var c=e.page,r=$(c);r.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),i(t),!1}),a.find(".paginate").empty().append(r)}else a.find(".modulePicker-list").append("<p class='txtCenter'>对不起，暂无自定义模块</p>");n&&n()};$.ajax({url:"/Design/getModule?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?o(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})};i(1,function(){$.jBox.show({title:"选择自定义模块",content:a,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(n){a.on("click",".j-select",function(){var a=$(".modulePicker-list li").index($(this).parent("li"));e&&e(t[a]),$.jBox.close(n)})}})})},HYD.popbox.GoodsAndGroupPicker=function(e,t){var n,a,i=$("#tpl_popbox_GoodsAndGroupPicker").html(),o=$(i),s=[],l=[],c=function(e,t){var a=function(e){if(n=e.list,n&&n.length){var a=$("#tpl_popbox_GoodsAndGroupPicker_goodsitem").html(),i=_.template(a,{dataset:n}),r=$(i);r.find(".j-select").click(function(){var e,t=$(this),a=t.parent("li"),i=a.index(),o=a.data("item"),c=$(".j-verify").val();if(e=""!=c?c.split(","):[],a.hasClass("selected")){if(a.removeClass("selected"),t.removeClass("btn-success").text("选取"),0!=s.length)for(var r=0;r<s.length;r++)if(o==s[r].item_id){s.splice(r,1);break}if(0!=l.length)for(var r=0;r<l.length;r++){var d=l[r];if(o==d){l.splice(r,1);break}}if(0!=e.length){for(var r=0;r<e.length;r++){var d=e[r];if(o==d){e.splice(r,1);break}}c=e.join(","),$(".j-verify").val(c)}}else a.addClass("selected"),t.addClass("btn-success").text("已选"),s.push(n[i]),l.push(o),e.push(o),c=e.join(","),$(".j-verify").val(c)}),o.find(".gagp-goodslist").empty().append(r);var d=e.page,p=$(d);p.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),c(t),!1}),o.find(".paginate:eq(0)").empty().append(p)}else o.find(".gagp-goodslist").append("<p class='txtCenter'>对不起，暂无数据</p>");var u=[];""!=$(".j-verify").val()?u=$(".j-verify").val().split(","):$(".img-list li").not(".img-list-add").each(function(e,t){var n=$(this).data("item");u.push(n)}),o.find("li").each(function(e,t){var n=$(this),a=n.data("item");$.each(u,function(e,t){a==t&&(n.addClass("selected"),n.children(".j-select").addClass("btn-success").text("已选"))})}),t&&t()};$.ajax({url:"/Design/getItem?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?a(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},r=function(e,t){var n=function(e){if(a=e.list,a&&a.length){var n=$("#tpl_popbox_GoodsAndGroupPicker_groupitem").html(),i=_.template(n,{dataset:a}),s=$(i);o.find(".gagp-grouplist").empty().append(s);var l=e.page,c=$(l);c.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),r(t),!1}),o.find(".paginate").empty().append(c)}else o.find(".gagp-grouplist").append("<p class='txtCenter'>对不起，暂无数据</p>");var d=$(".badge-success").data("group");void 0!=d&&o.find(".gagp-grouplist li").each(function(e,t){var n=$(this),a=n.data("group");d==a&&n.find(".j-select").addClass("btn-success").text("已选")}),t&&t()};$.ajax({url:"/Design/getGroup?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?n(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},d=function(e,n){o.on("click",".j-btn-goodsuse",function(){var n=1;t&&t(s,n,l),$.jBox.close(e)})},p=function(e){var a=1;o.find(".j-btn-goodsuse").remove(),o.on("click",".gagp-goodslist .j-select",function(){var i=$(".gagp-goodslist li").index($(this).parent("li"));t&&t(n[i],a),$.jBox.close(e)})},u=function(e){var n=2;o.on("click",".gagp-grouplist .j-select",function(){var i=$(".gagp-grouplist li").index($(this).parent("li"));t&&t(a[i],n),$.jBox.close(e)})},g=function(e){p(e),o.find(".j-tab-group").one("click",function(){r(1,function(){u(e)})})};switch(e){case"goods":case"goodsMulti":o.find(".tabs").remove(),o.find(".gagp-goodslist").unwrap().unwrap(),o.find(".tc[data-index='2']").remove(),c(1,function(){var t='<span class="fl">选择商品</span><div class="goodsearch"><input type="text" name="title" placeholder="请输入商品名称" /><select class="select small newselect" style="width:90px;"><option value="-1">在售中</option><option value="3">仓库中</option></select><a href="javascript:;" class="btn btn-primary jGetgood"><i class="gicon-search white"></i>查询</a></div>';$.jBox.show({title:t,content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(t){if("goodsMulti"==e){var a=[];$(".img-list li").not(".img-list-add").each(function(e,t){var n=$(this).data("item");a.push(n)}),o.find("li").each(function(e,t){var n=$(this),i=n.data("item");$.each(a,function(e,t){i==t&&(n.addClass("selected"),n.children(".j-select").addClass("btn-success").text("已选"))})}),d(t,a)}else p(t);$(document).on("click",".jGetgood",function(e){var t=$(this).siblings("input").val(),a=$(this).siblings("select").val(),i=function(e,c){e=e?e:1;var r=function(e){if(n=e.list,n&&n.length){var t=$("#tpl_popbox_GoodsAndGroupPicker_goodsitem").html(),a=_.template(t,{dataset:n}),r=$(a);r.find(".j-select").click(function(){var e,t=$(this),a=t.parent("li"),i=a.index(),o=a.data("item"),c=$(".j-verify").val();if(e=""!=c?c.split(","):[],a.hasClass("selected")){if(a.removeClass("selected"),t.removeClass("btn-success").text("选取"),0!=s.length)for(var r=0;r<s.length;r++)if(o==s[r].item_id){s.splice(r,1);break}if(0!=l.length)for(var r=0;r<l.length;r++){var d=l[r];if(o==d){l.splice(r,1);break}}if(0!=e.length){for(var r=0;r<e.length;r++){var d=e[r];if(o==d){e.splice(r,1);break}}c=e.join(","),$(".j-verify").val(c)}}else a.addClass("selected"),t.addClass("btn-success").text("已选"),s.push(n[i]),l.push(o),e.push(o),c=e.join(","),$(".j-verify").val(c)}),o.find(".gagp-goodslist").empty().append(r);var d=e.page,p=$(d);p.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),i(t),!1}),o.find(".paginate:eq(0)").empty().append(p)}else o.find(".gagp-goodslist").empty().append("<p class='txtCenter'>对不起，暂无数据</p>"),o.find(".paginate").empty();c&&c()};$.ajax({url:"/Design/getItem?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e),title:t,status:a},success:function(e){1==e.status?r(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})};i()})}})});break;case"group":o.find(".tabs").remove(),o.find(".gagp-grouplist").unwrap().unwrap(),o.find(".tc[data-index='1']").remove(),r(1,function(){$.jBox.show({title:"选择商品分组",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){u(e)}})});break;case"all":c(1,function(){$.jBox.show({title:"选择商品或商品分组",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){g(e)}})})}},HYD.popbox.MgzAndMgzCate=function(e,t){var n,a,i=$("#tpl_popbox_MgzAndMgzCate").html(),o=$(i),s=function(e,t){var a=function(e){if(n=e.list,n&&n.length){var a=$("#tpl_popbox_MgzAndMgzCate_item").html(),i=_.template(a,{dataset:n}),l=$(i);l.find(".j-select").click(function(){var e=$(this),t=e.parent("li");t.hasClass("selected")?(t.removeClass("selected"),e.removeClass("btn-success").text("选取")):(t.addClass("selected"),e.addClass("btn-success").text("已选"))}),o.find(".mgz-list-panel1").empty().append(l);var c=e.page,r=$(c);r.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),s(t),!1}),o.find(".paginate").empty().append(r)}else o.find(".mgz-list-panel1").empty().append("<p class='txtCenter'>对不起，暂无数据</p>");t&&t()};$.ajax({url:"/Design/getMagazine?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?a(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},l=function(e,t){var n=function(e){if(a=e.list,a&&a.length){var n=$("#tpl_popbox_MgzAndMgzCate_item").html(),i=_.template(n,{dataset:a}),s=$(i);s.find(".j-select").click(function(){var e=$(this),t=e.parent("li");t.hasClass("selected")?(t.removeClass("selected"),e.removeClass("btn-success").text("选取")):(t.addClass("selected"),e.addClass("btn-success").text("已选"))}),o.find(".mgz-list-panel2").empty().append(s);var c=e.page,r=$(c);r.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),l(t),!1}),o.find(".paginate").empty().append(r)}else o.find(".mgz-list-panel2").empty().append("<p class='txtCenter'>对不起，暂无数据</p>");t&&t()};$.ajax({url:"/Design/getMagazineCategory?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?n(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},c=function(e){o.on("click",".mgz-list-panel1 .j-select",function(){var a=$(".mgz-list-panel1 li").index($(this).parent("li"));t&&t(n[a],22),$.jBox.close(e)})},r=function(e){o.on("click",".mgz-list-panel2 .j-select",function(){var n=$(".mgz-list-panel2 li").index($(this).parent("li"));t&&t(a[n],4),$.jBox.close(e)})},d=function(e){o.on("click",".j-btn-use",function(){var n=[],i=4;o.find(".mgz-list-panel2 li.selected").each(function(){n.push(a[$(this).index()])}),t&&t(n,i),$.jBox.close(e)})},p=function(e){c(e),o.find(".j-tab-mgzcate").one("click",function(){l(1,function(){r(e)})})};switch(e){case"mgzCate":o.find(".tabs").remove(),o.find(".mgz-list-panel2").unwrap().unwrap(),o.find(".tc[data-index='1']").remove(),o.find(".j-btn-use").remove(),l(1,function(){$.jBox.show({title:"选择专题分类",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){r(e)}})});break;case"mgzCateMulti":o.find(".tabs").remove(),o.find(".mgz-list-panel2").unwrap().unwrap(),o.find(".tc[data-index='1']").remove(),l(1,function(){$.jBox.show({title:"选择专题分类",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){d(e)}})});break;case"mgz":o.find(".tabs").remove(),o.find(".mgz-list-panel1").unwrap().unwrap(),o.find(".tc[data-index='2']").remove(),o.find(".j-btn-use").remove(),s(1,function(){$.jBox.show({title:"选择专题页面",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){p(e)}})});break;case"all":o.find(".j-btn-use").remove(),s(1,function(){$.jBox.show({title:"选择专题页面或者分类",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){p(e)}})})}switch(e){case"goods":case"goodsMulti":o.find(".tabs").remove(),o.find(".gagp-goodslist").unwrap().unwrap(),o.find(".tc[data-index='2']").remove(),showListRender_goods(1,function(){$.jBox.show({title:"选择商品",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(t){"goodsMulti"==e?selectEvent_goods_multi(t):selectEvent_goods(t)}})});break;case"group":o.find(".tabs").remove(),o.find(".gagp-grouplist").unwrap().unwrap(),o.find(".tc[data-index='1']").remove(),showListRender_group(1,function(){$.jBox.show({title:"选择商品分组",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){selectEvent_group(e)}})});break;case"all":showListRender_goods(1,function(){$.jBox.show({title:"选择商品或商品分组",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){selectEvent_goodsAndGroup(e)}})})}},HYD.popbox.GoodsSelectClass=function(e,t){var n,a,i=$("#tpl_popbox_MgzAndMgzCate").html(),o=$(i),s=function(e,t){var a=function(e){if(n=e.list,n&&n.length){var a=$("#tpl_popbox_MgzAndMgzCate_item").html(),i=_.template(a,{dataset:n}),l=$(i);l.find(".j-select").click(function(){var e=$(this),t=e.parent("li");t.hasClass("selected")?(t.removeClass("selected"),e.removeClass("btn-success").text("选取")):(t.addClass("selected"),e.addClass("btn-success").text("已选"))}),o.find(".mgz-list-panel1").empty().append(l);var c=e.page,r=$(c);r.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),s(t),!1}),o.find(".paginate").empty().append(r)}else o.find(".mgz-list-panel1").empty().append("<p class='txtCenter'>对不起，暂无数据</p>");t&&t()};$.ajax({url:"/Item/get_item_class_link?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?a(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},l=function(e,t){var n=function(e){if(a=e.list,a&&a.length){var n=$("#tpl_popbox_MgzAndMgzCate_item").html(),i=_.template(n,{dataset:a}),s=$(i);s.find(".j-select").click(function(){var e=$(this),t=e.parent("li");t.hasClass("selected")?(t.removeClass("selected"),e.removeClass("btn-success").text("选取")):(t.addClass("selected"),e.addClass("btn-success").text("已选"))}),o.find(".mgz-list-panel2").empty().append(s);var c=e.page,r=$(c);r.filter("a:not(.disabled,.cur)").click(function(){var e=$(this).attr("href"),t=e.split("/");return t=t[t.length-1],t=t.replace(/.html/,""),l(t),!1}),o.find(".paginate").empty().append(r)}else o.find(".mgz-list-panel2").empty().append("<p class='txtCenter'>对不起，暂无数据</p>");t&&t()};$.ajax({url:"/Design/getMagazineCategory?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(e)},success:function(e){1==e.status?n(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},c=function(e){o.on("click",".mgz-list-panel1 .j-select",function(){var a=$(".mgz-list-panel1 li").index($(this).parent("li"));t&&t(n[a],12),$.jBox.close(e)})},r=function(e){o.on("click",".mgz-list-panel2 .j-select",function(){var n=$(".mgz-list-panel2 li").index($(this).parent("li"));t&&t(a[n],4),$.jBox.close(e)})},d=function(e){c(e),o.find(".j-tab-mgzcate").one("click",function(){l(1,function(){r(e)})})};switch(e){case"mgz":o.find(".tabs").remove(),o.find(".mgz-list-panel1").unwrap().unwrap(),o.find(".tc[data-index='2']").remove(),o.find(".j-btn-use").remove(),s(1,function(){$.jBox.show({title:"选择商品分类",content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){d(e)}})})}},HYD.popbox.GamePicker=function(e,t){var n=$("#tpl_popbox_GamePicker").html(),a=$(n),i={1:[],2:[],3:[],4:[]},o=function(e,t,n){var s=function(t){if(i[e]=t.list,i[e]&&i[e].length){var s=$("#tpl_popbox_GamePicker_item").html(),l=_.template(s,{dataset:i[e]}),c=$(l);c.find(".j-select").click(function(){var e=$(this),t=e.parent("li");t.hasClass("selected")?(t.removeClass("selected"),e.removeClass("btn-success").text("选取")):(t.addClass("selected"),e.addClass("btn-success").text("已选"))}),a.find(".game-list-panel"+e).empty().append(c);var r=t.page,d=$(r);d.filter("a:not(.disabled,.cur)").click(function(){var t=$(this).attr("href"),n=t.split("/");return n=n[n.length-1],n=n.replace(/.html/,""),o(e,n),!1}),a.find(".paginate:eq("+(e-1)+")").empty().append(d)}else a.find(".game-list-panel"+e).empty().append("<p class='txtCenter'>对不起，暂无数据</p>");n&&n(e)},l={1:1,2:4,3:3,4:5};$.ajax({url:"/Design/getGame?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{p:parseInt(t),type:parseInt(l[e])},success:function(e){1==e.status?s(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})},s=function(e,n){a.on("click",".game-list-panel"+n+" .j-select",function(){var a=$(".game-list-panel"+n+" li").index($(this).parent("li"));t&&t(i[n][a],5),$.jBox.close(e)})};o(1,1,function(e){$.jBox.show({title:"选择营销活动",content:a,height:600,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(t){s(t,e),a.find(".j-tab-game").one("click",function(){var e=$(this).data("index");o(e,1,function(e){s(t,e)})})}})})},HYD.popbox.dplPickerColletion=function(e){var t={linkType:1,extraParams:{},callback:null},n=$.extend(!0,{},t,e);switch(console.log(n),parseInt(n.linkType)){case 1:var a={title:"首页",link:1};n.callback(a,1);break;case 3:var a={title:"商品",link:3};n.callback(a,3);break;case 6:var a={title:"我的",link:6};n.callback(a,6);break;case 7:var a={title:"套餐列表",link:7};n.callback(a,7);break;case 10:var a={title:"项目列表",link:10};n.callback(a,10);break;case 11:var a={title:"拨打电话",link:11};n.callback(a,11);break;case 12:var a={title:"优惠活动",link:12};n.callback(a,12);break;case 13:HYD.popbox.GoodsSelectClass("mgz",n.callback);break;case 14:var a={title:"门店列表",link:14};n.callback(a,14);break;case 15:var a={title:"拨打电话",link:15};n.callback(a,15);break;case 16:var a={title:"地图导航",link:11};n.callback(a,16);break;case 17:var a={title:"购物车",link:17};n.callback(a,17);break;case 19:var a={title:"优惠券",link:"/User/get_coupon"};n.callback(a,19);break;case 20:var a={title:"积分兑换",link:"/User/point_exchange"};n.callback(a,20);break;case 21:var a={title:"包厢预订",link:"/Booking/setting"};n.callback(a,21);break;case 22:HYD.popbox.MgzAndMgzCate("mgz",n.callback);break;case 23:var a={title:"专题列表",link:23};n.callback(a,23);break;case 24:var a={title:"在线买单",link:24};n.callback(a,24);break;case 25:var a={title:"优惠列表页",link:25};n.callback(a,25);break;case 26:var a={title:"会员页",link:26};n.callback(a,26);break;case 27:var a={title:"我的",link:27};n.callback(a,27)}},HYD.ajaxPopTable=function(e){var t,n,a={title:"",url:"",width:"auto",minHeight:"auto",data:{p:1},tpl:"",onOpen:null,onPageChange:null},i=$.extend(!0,{},a,e),o=$("<div></div>"),s=function(e){var a=i.tpl,l=i.url,c=function(l){t=l;var c=_.template(a,l),r=$(c);o.empty().append(r),o.find(".paginate a:not(.disabled,.cur)").click(function(){for(var e=$(this).attr("href"),t=e.split("/"),n=0;n<t.length;n++)if("p"==t[n]){i.data.p=t[n+1].replace(/.html/,""),s();break}return!1}),e&&e(),i.onPageChange&&i.onPageChange(n,t)};$.ajax({url:l+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:i.data,success:function(e){1==e.status?c(e):HYD.hint("danger","对不起，获取数据失败："+e.msg)}})};s(function(){$.jBox.show({title:i.title,width:i.width,minHeight:i.minHeight,content:o,btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(e){n=e,i.onOpen&&i.onOpen(e,t)}})})},HYD.regRules={email:/^[a-z]([a-z0-9]*[-_]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[\.][a-z]{2,3}([\.][a-z]{2})?$/i,mobphone:/^(1(([35][0-9])|(47)|[8][01236789]))\d{8}$/,telphone:/^0\d{2,3}(\-)?\d{7,8}$/,integer:/^\d+$/,float:/^[\d]*\.?[\d]+$/},HYD.popbox.iconimgsrc={data:{style1:{color0:["/image/style1/color0/home.png","/image/style1/color0/huojia.png","/image/style1/color0/mine.png","/image/style1/color0/icon1.png","/image/style1/color0/icon2.png","/image/style1/color0/icon3.png","/image/style1/color0/icon4.png","/image/style1/color0/icon5.png","/image/style1/color0/fruitItem.png","/image/style1/color0/hotel1.png","/image/style1/color0/hotel2.png","/image/style1/color0/hotel3.png","/image/style1/color0/hotel4.png","/image/style1/color0/fam_ic1.png","/image/style1/color0/fam_ic2.png","/image/style1/color0/fam_ic3.png","/image/style1/color0/fam_ic4.png","/image/style1/color0/fam_ic5.png","/image/style1/color0/flower1.png","/image/style1/color0/flower2.png","/image/style1/color0/flower3.png","/image/style1/color0/flower4.png","/image/style1/color0/flower5.png","/image/style1/color0/ktv_icon1.png","/image/style1/color0/ktv_icon2.png","/image/style1/color0/ktv_icon3.png","/image/style1/color0/ktv_icon4.png","/image/style1/color0/ktv_icon5.png","/image/style1/color0/footIcon1.png","/image/style1/color0/footIcon2.png","/image/style1/color0/footIcon3.png","/image/style1/color0/footIcon4.png","/image/style1/color0/footIcon5.png","/image/style1/color0/yoga1.png","/image/style1/color0/yoga2.png","/image/style1/color0/yoga3.png","/image/style1/color0/yoga4.png","/image/style1/color0/liren_icon1.png","/image/style1/color0/liren_icon2.png","/image/style1/color0/liren_icon3.png","/image/style1/color0/liren_icon4.png","/image/style1/color0/liren_icon5.png","/image/style1/color0/travel_icon1.png","/image/style1/color0/travel_icon2.png","/image/style1/color0/travel_icon3.png","/image/style1/color0/travel_icon4.png","/image/style1/color0/travel_icon5.png"],color1:["/image/style1/color1/homeselect.png","/image/style1/color1/huojiaselect.png","/image/style1/color1/mineselect.png"],color2:["/image/style1/color2/icon1s.png","/image/style1/color2/icon2s.png","/image/style1/color2/icon3s.png","/image/style1/color2/icon4s.png","/image/style1/color2/icon5s.png","/image/style1/color2/yoga1s.png","/image/style1/color2/yoga2s.png","/image/style1/color2/yoga3s.png","/image/style1/color2/yoga4s.png"],color3:["/image/style1/color3/fruitItem.png","/image/style1/color3/homeselect.png","/image/style1/color3/mineselect.png","/image/style1/color3/travel_icon1s.png","/image/style1/color3/travel_icon2s.png","/image/style1/color3/travel_icon3s.png","/image/style1/color3/travel_icon4s.png","/image/style1/color3/travel_icon5s.png"],color4:["/image/style1/color4/hotel1s.png","/image/style1/color4/hotel2s.png","/image/style1/color4/hotel3s.png","/image/style1/color4/hotel4s.png","/image/style1/color4/fam_ic1s.png","/image/style1/color4/fam_ic2s.png","/image/style1/color4/fam_ic3s.png","/image/style1/color4/fam_ic4s.png"],
    color5: ["/image/style1/color5/flower1s.png", "/image/style1/color5/flower2s.png", "/image/style1/color5/flower3s.png", "/image/style1/color5/flower4s.png", "/image/style1/color5/flower5s.png", "/image/style1/color5/liren_icon1s.png", "/image/style1/color5/liren_icon2s.png", "/image/style1/color5/liren_icon3s.png", "/image/style1/color5/liren_icon4s.png", "/image/style1/color5/liren_icon5s.png"], color6: ["/image/style1/color6/footIcon1s.png", "/image/style1/color6/footIcon2s.png", "/image/style1/color6/footIcon3s.png", "/image/style1/color6/footIcon4s.png", "/image/style1/color6/footIcon5s.png"], color7: ["/image/style1/color7/phy_icon1s.png", "/image/style1/color7/phy_icon2s.png", "/image/style1/color7/phy_icon3s.png", "/image/style1/color7/phy_icon4s.png", "/image/style1/color7/phy_icon5s.png", "/image/style1/color7/ktv_icon1s.png", "/image/style1/color7/ktv_icon2s.png", "/image/style1/color7/ktv_icon3s.png", "/image/style1/color7/ktv_icon4s.png", "/image/style1/color7/ktv_icon5s.png"], color8: ["/fonts/icon_home.png","/Public/images/icon/style1/color8/icon_allgoods.png","/Public/images/icon/style1/color8/icon_newgoods.png","/Public/images/icon/style1/color8/icon_user.png","/Public/images/icon/style1/color8/icon_fx.png","/Public/images/icon/style1/color8/icon_active.png","/Public/images/icon/style1/color8/icon_hotsale.png","/Public/images/icon/style1/color8/icon_subject.png","/Public/images/icon/style1/color8/style1_gz8.png","/Public/images/icon/style1/color8/style1_shopcar8.png"]}}},$(function(){$(".header-ctrl-item").hover(function(){var e=$(this);e.data("type"),e.data("cache");e.find(".header-ctrl-item-children").length&&e.addClass("show")},function(){$(this).removeClass("show")}),$(".tips").tooltips();var e=$(".container .inner");if(e.length){var t=function(){HYD.Constant.windowHeight=$(this).height(),HYD.Constant.windowWidth=$(this).width(),HYD.Constant.containerOffset=e.offset(),HYD.Constant.containerWidth=e.outerWidth()},n=function(){$("#j-gotop").css("left",HYD.Constant.containerWidth+HYD.Constant.containerOffset.left+10)};$(window).resize(function(){t(),n()}),t(),n()}$(window).scroll(function(){$(this).scrollTop()>=150?$("#j-gotop").fadeIn(300):$("#j-gotop").fadeOut(300)}),$.ajaxSetup({timeout:2e4,error:function(e,t,n){"timeout"==t&&(HYD&&HYD.hint?HYD.hint("warning","请求超时，请重试！"):alert("请求超时，请重试！"),$.jBox.hideloading())}}),function(){var e=function(){$.jBox.show({title:"温馨提示",width:520,content:$("#tpl_jbox_domain_tip").html(),btnOK:{show:!1},btnCancel:{show:!1},onOpen:function(){},onClosed:function(){}})};window.is_domain_tip&&e()}(),$(".js-save-btn").click(function(){HYD.hint("success","恭喜，保存成功！")});var a=$(".content-right ").width();$(".diy-actions").width(a-40)}),$(function(){var e=$(".wxtables").find("input[type='checkbox'].table-ckbs");$(".btn_table_selectAll").click(function(){e.attr("checked",!0)}),$(".btn_table_Cancle").click(function(){e.attr("checked",!1)}),$(".paginate").each(function(){var e=$(this),t=e.find("input"),n=e.find(".goto"),a=window.location.href.toString();t.focus(function(){$(this).addClass("focus").siblings(".goto").addClass("focus")}),t.blur(function(){""==$(this).val()&&$(this).removeClass("focus").siblings(".goto").removeClass("focus")}),t.keypress(function(e){var t=window.event?e.keyCode:e.which;return 13==t&&(window.location.href=$(this).siblings("a.goto").attr("href")),8==t||46==t||37==t||39==t||!(t<48||t>57)}),t.keyup(function(e){var t=$(this).val(),i=a.split("/"),o=i.length,s=!1,l=!1;""==i[o-1]&&(i.pop(),o=i.length,s=!0),(s||"p"!=i[o-2])&&(i.push("p"),o=i.length,l=!0),s||l?i[o]=t+".html":i[o-1]=t+".html",n.attr("href",i.join("/"))})})}),$(function(){$(document).on("click",".tabs .tabs_a",function(){var e=$(this),t=e.data("origin"),n=0;e.parent().hasClass("wizardstep")||e.parent().hasClass("nochange")||(e.addClass("active").siblings(".tabs_a").removeClass("active"),e.data("index")?(n=e.data("index"),$(".tabs-content[data-origin='"+t+"']").find(".tc[data-index='"+n+"']").removeClass("hide").siblings(".tc").addClass("hide")):(n=e.index(),$(".tabs-content[data-origin='"+t+"']").find(".tc:eq("+n+")").removeClass("hide").siblings(".tc").addClass("hide")))})}),$(function(){$(".alert.disable-del").each(function(){var e=$('<a href="javascript:;" class="alert-delete" title="隐藏"><i class="gicon-remove"></i></a>');e.click(function(){$(this).parent(".alert").fadeOut()}),$(this).append(e)}),_QV_="%E6%9D%AD%E5%B7%9E%E5%90%AF%E5%8D%9A%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89"}),function(e,t,n){var a={trigger:"hover"};e.fn.tooltips=function(){return this.each(function(){var t=function(){var t=e(this),n=t.data("content"),a=t.offset(),i={width:t.outerWidth(!0),height:t.outerHeight(!0)},o=t.data("placement");if(this.tip=null,n=void 0==n||""==n?n=t.text():n,null==this.$tip){var s=e("#tpl_tooltips").html();if(void 0==s||""==s)return void console.log("Please check template!");var l=_.template(s,{content:n,placement:o});this.$tip=e(l),e("body").append(this.$tip);var c=0,r=0,d=this.$tip.outerWidth(!0),p=this.$tip.outerHeight(!0);switch(o){case"top":c=a.top+i.height+5,r=a.left-5;break;case"bottom":c=a.top-p-5,r=a.left-5;break;case"left":c=a.top-i.height/2,r=a.left+i.width+5;break;case"right":c=a.top+i.height/2-p/2,r=a.left-d-5}this.$tip.css({top:c,left:r})}this.$tip.stop(!0,!0).fadeIn(300)},n=function(){this.$tip&&this.$tip.stop(!0,!0).fadeOut(300)},i=e(this).data("trigger");switch(i=void 0!=i&&""!=i?i:a.trigger){case"hover":e(this).hover(t,n);break;case"click":e(this).click(t).mouseleave(n)}})}}(jQuery,document,window),$(function(){$(document).on("mouseover",".droplist .j-droplist-toggle",function(){$(this).siblings(".droplist-menu").show()}),$(document).on("mouseleave",".droplist .droplist-menu",function(){$(this).hide()}),$(document).on("mouseleave",".droplist",function(){$(this).find(".droplist-menu").hide()}),$(document).on("click",".droplist .droplist-menu a",function(){$(this).parents(".droplist-menu").hide()})}),function(e,t,n){var a={callback:null},i={},o={width:e(n).width(),height:e(n).height()},s={main:e("#tpl_albums_main").html(),overlay:e("#tpl_albums_overlay").html(),tree:e("#tpl_albums_tree").html(),treeFn:e("#tpl_albums_tree_fn").html(),imgs:e("#tpl_albums_imgs").html()},l={folderID:"",moveFolderID:0,imgs:{}},c={getFolderTree:"/Design/getFolderTree",getSubFolderTree:"/Design/getSubFolderTree",getImgList:"/Design/getImgList",addImg:"/Design/uploadFile/sid/"+e.cookie("shop_id"),moveImg:"/Design/moveImg",delImg:"/Design/delImg",addFolder:"/Design/addFolder",renameFolder:"/Design/renameFolder",delFolder:"/Design/delFolder",moveCateImg:"/Design/moveCateImg",renameImg:"/Design/renameImg"},r=function(t,n,a,i){var o=arguments.callee,r=t.find("#j-panelImgs"),d=t.find("#j-panelPaginate"),p=n>=0?{id:n,p:a,file_name:i}:{p:a,file_name:i};"undefined"==typeof GLOBAL_NEED_COMPRESS||0==GLOBAL_NEED_COMPRESS?p.need_compress=0:p.need_compress=1,e.ajax({url:c.getImgList+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:p,beforeSend:function(){r.find(".j-loading").show()},success:function(a){if(1==a.status){l.imgs=_.isArray(a.data)?a.data:null;var c=e(_.template(s.imgs,{dataset:l.imgs})),p=e(a.page);r.find(".j-loading").hide().end().find("ul,.j-noPic").remove().end().append(c),d.empty().append(p),p.filter("a:not(.disabled,.cur)").click(function(){var a=e(this).attr("href"),s=a.split("/");return s=s[s.length-1],s=s.replace(/.html/,""),o(t,n,s,i),!1})}else HYD.hint("danger","对不起，图片获取失败："+a.msg)}})};UpdateSubTreeNums=function(n){if("undefined"==typeof n)var n=e(t).find(".j-albumsNodes .selected").data("id");e.ajax({url:"/Design/getAllSubFolderTree?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:n},success:function(n){if(1==n.status){var a=n.data.tree,i=e(t).find("#j-panelTree");a.push({id:"-1",picNum:n.data.total},{id:"0",picNum:n.data.nocat_total});var o=function(e){var t=arguments.callee;_.each(e,function(e){i.find("dt[data-id="+e.id+"]").find(".j-num").text(e.picNum),e.subFolder&&e.subFolder.length&&t(e.subFolder)})};o(a)}else console.log("更新文件夹树图片数量失败")}})},e.albums=function(d){i=e.extend(!0,{},a,d);var p=e("#albums"),u=e("#albums-overlay");if(!p.length){p=e(s.main),u=e(s.overlay),e("body").append(p.hide(),u.hide());var g=p.find("#j-close"),f=p.find("#j-addFolder"),m=p.find("#j-renameFolder"),h=p.find("#j-delFolder"),v=p.find("#j-addImg"),b=p.find("#j-moveImg"),$=p.find("#j-cateImg"),y=p.find("#j-delImg"),k=p.find("#j-panelTree"),j=function(){p.fadeOut("fast"),u.fadeOut("fast"),p.find("#j-panelImgs li").removeClass("selected")};e.ajax({url:c.getFolderTree+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",success:function(t){if(1==t.status){var n=_.template(s.treeFn),a=n({dataset:t.data.tree,templateFn:n}),i=e(_.template(s.tree,{dataset:t.data,nodes:a}));k.empty().append(i),p.find(".j-albumsNodes > dt:first").click()}else HYD.hint("danger","对不起，文件夹获取失败："+t.msg)}}),e(t).on("click",".j-albumsNodes dt",function(t){var n=e(this),a=n.data("id");if(n.parents(".j-albumsNodes").find("dt").removeClass("selected"),n.addClass("selected"),e(t.currentTarget).parents(".j-propagation").length)l.moveFolderID=a;else{if(l.folderID==a)return;l.folderID=a;var i=n.data("add"),o=n.data("rename"),s=n.data("del");1==i?f.show():f.hide(),1==o?m.show():m.hide(),1==s?h.show():h.hide(),r(p,l.folderID,1)}return a==-1?f.show():f.hide(),!1});var x=function(t,n){e.ajax({url:c.getSubFolderTree+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{id:n},success:function(n){if(1==n.status){var a=_.template(s.treeFn),i=a({dataset:n.data,templateFn:a});$render=e(i),t.parent("dt").siblings("dd").empty().append($render),$render.filter("dl").slideDown(200)}}})};e(t).on("click",".j-albumsNodes dt i",function(){var t=e(this),n=t.parent("dt").siblings("dd").find(" > dl"),a=n.length,i=t.parent("dt").data("id");return t.hasClass("open")?(t.removeClass("open"),n.slideUp(200)):(t.addClass("open"),a?n.slideDown(200):x(t,i)),!1});var w=0;p.on("click","#j-panelImgs li",function(){return e(this).toggleClass("selected"),e(this).find(".img-name-edit").hide(),e(this).data("selectindex",w++),!1}),p.on("click","#j-panelImgs li .albums-edit",function(){return e(this).children(".img-name-edit").show(),!1}),p.on("click","#j-useImg",function(){if(!p.find("#j-panelImgs li.selected").length)return void HYD.hint("warning","请选择图片！");var t={},n=[];p.find("#j-panelImgs li.selected").each(function(){t[e(this).data("selectindex")]=l.imgs[e(this).index()].file});for(var a in t)n.push(t[a]);return i.callback&&(i.callback(n),j()),!1}),f.click(function(){var t=[{id:0,name:"未命名文件夹",picNum:0}];return l.folderID==-1&&void e.ajax({url:c.addFolder+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{name:t.name,parent_id:l.folderID},success:function(n){if(1==n.status){t[0].id=n.data;var a=_.template(s.treeFn,{dataset:t});$render=e(a),k.find("dt[data-id='"+l.folderID+"']").siblings("dd").append($render),$render.css("display","block"),$render.parent().siblings("dt").find(".icon-folder").addClass("open"),$render.find("dt:first").click(),m.click()}else HYD.hint("danger","对不起，添加失败："+n.msg)}})}),m.click(function(){var t=k.find("dt[data-id='"+l.folderID+"']"),n=t.find(".j-treeShowTxt"),a=t.find(".j-ip"),i=t.find(".j-loading");n.hide(),a.show().focus().select(),a.blur(function(){var t=e(this).val();e.ajax({url:c.renameFolder+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{name:t,category_img_id:l.folderID},beforeSend:function(){i.css("display","inline-block")},success:function(e){1==e.status?n.find(".j-name").text(t):HYD.hint("danger","对不起，重命名失败："+e.msg),n.show(),a.hide(),i.hide()}})})}),h.click(function(){var t=e("#tpl_albums_delFolder").html(),n=e(t),a=n.find("input[name=isDelImgs]");e.jBox.show({title:"提示",content:n,btnOK:{onBtnClick:function(t){var n=a.filter(":checked").val();e.ajax({url:c.delFolder+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{type:n,id:l.folderID},success:function(e){if(1==e.status){UpdateSubTreeNums();var t=k.find("dt[data-id="+l.folderID+"]").parent("dl");t.parent("dd").siblings("dt").click(),t.remove()}else HYD.hint("danger","对不起，删除失败失败："+e.msg)}}),e.jBox.close(t)}}})}),y.click(function(){if(!p.find("#j-panelImgs li.selected").length)return void HYD.hint("warning","请选择要删除的图片！");var t=[];p.find("#j-panelImgs li.selected").each(function(){t.push(e(this).data("id"))}),e.ajax({url:c.delImg+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{file_id:t},success:function(t){1==t.status?(p.find("#j-panelImgs li.selected").fadeOut(300,function(){e(this).remove()}),UpdateSubTreeNums()):HYD.hint("danger","对不起，删除失败："+t.msg)}})});var C=n.navigator.plugins,D=[],I="Shockwave Flash";for(var H in C)D.push(C[H].name);D.indexOf(I)>0?v.uploadify({debug:!1,auto:!0,width:86,height:28,multi:!0,swf:"/Public/plugins/uploadify/uploadify.swf",uploader:c.addImg,buttonText:"上传图片",fileSizeLimit:"5MB",fileTypeExts:"*.jpg; *.jpeg; *.png; *.gif; *.bmp",onUploadStart:function(){v.uploadify("settings","formData",{cate_id:l.folderID==-1?0:l.folderID,PHPSESSID:e.cookie("PHPSESSID")})},onSelectError:function(e,t,n){switch(t){case-100:HYD.hint("danger","对不起，系统只允许您一次最多上传10个文件");break;case-110:HYD.hint("danger","对不起，文件 ["+e.name+"] 大小超出5MB！");break;case-120:HYD.hint("danger","文件 ["+e.name+"] 大小异常！");break;case-130:HYD.hint("danger","文件 ["+e.name+"] 类型不正确！")}},onFallback:function(){HYD.hint("danger","您未安装FLASH控件，无法上传图片！请安装FLASH控件后再试。")},onUploadSuccess:function(e,t,n){console.log(e,t,n)},onQueueComplete:function(e){r(p,l.folderID,1),UpdateSubTreeNums()},onUploadError:function(e,t,n,a){HYD.hint("danger","对不起："+e.name+"上传失败："+a)}}):(v.css({opacity:0,width:"62px"}),e(".no-flash").css("position","relative"),e(".no-flash").addClass("btn btn-success"),e(".no-text").text("上传图片"),HYD.hint("danger","系统检测到您的电脑未安装flash，为了更好地体验，请先安装flash插件",3e3),e("#j-addImg").change(function(){var t=e(this),n=t.get(0).files[0],a=((new Date).getTime(),5242880);if(console.log(n),n.size>a)return HYD.hint("danger","上传的图片不得大于5M!"),!1;var i=new XMLHttpRequest,o=new FormData;i.open("POST",c.addImg,!0),e.jBox.showloading(),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var t=e.parseJSON(i.responseText);1==t.status?(r(p,l.folderID,1),UpdateSubTreeNums()):HYD.hint("danger",t.msg),e.jBox.hideloading()}},o.append("Filedata",n),o.append("cate_id",l.folderID==-1?0:l.folderID),o.append("PHPSESSID",e.cookie("PHPSESSID")),i.send(o)})),b.click(function(){if(!p.find("#j-panelImgs li.selected").length)return void HYD.hint("warning","请选择要移动的图片！");var t=e("<div class='albums-cl-tree j-albumsNodes j-propagation'></div>");t.append(k.find("dd:first").contents().clone()),e.jBox.show({title:"请选择移动文件夹",content:t,onOpen:function(){t.find("dt:first").click()},btnOK:{onBtnClick:function(t){var n=[];p.find("#j-panelImgs li.selected").each(function(){n.push(e(this).data("id"))}),e.ajax({url:c.moveImg+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{file_id:n,cate_id:l.moveFolderID},success:function(n){if(1==n.status){var a=e(t).find(".j-albumsNodes .selected").data("id");p.find("#j-panelImgs li.selected").fadeOut(300,function(){e(this).remove()}),UpdateSubTreeNums(),UpdateSubTreeNums(a),HYD.hint("success","恭喜您，操作成功！")}else HYD.hint("danger","对不起，移动失败："+n.msg)}}),e.jBox.close(t)}}});var n=e(".jbox").last().css("z-index");n=n||9996,n=parseInt(n),e(".jbox").last().css("z-index",n+1)}),$.click(function(){if(!l.folderID)return void HYD.hint("warning","请选择要移动的分类！");var t=e("<div class='albums-cl-tree j-albumsNodes j-propagation'></div>");t.append(k.find("dd:first").contents().clone()),e.jBox.show({title:"请选择移动文件夹",content:t,onOpen:function(){t.find("dt:first").click()},btnOK:{onBtnClick:function(t){e.ajax({url:c.moveCateImg+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{cid:l.folderID,cate_id:l.moveFolderID},success:function(n){if(1==n.status){var a=e(t).find(".j-albumsNodes .selected").data("id");p.find("#j-panelImgs li.selected").fadeOut(300,function(){e(this).remove()}),UpdateSubTreeNums(),UpdateSubTreeNums(a),HYD.hint("success","恭喜您，操作成功！")}else HYD.hint("danger","对不起，移动失败："+n.msg)}}),e.jBox.close(t)}}});var n=e(".jbox").last().css("z-index");n=n||9996,n=parseInt(n),e(".jbox").last().css("z-index",n+1)}),g.click(j)}p.fadeIn("fast"),u.fadeIn("fast"),p.outerHeight()>=o.height&&p.css({position:"absolute",marginTop:"0",top:e(t).scrollTop()+10}),p.on("click",".renameImg",function(){var t=e(this),n=t.closest("li").data("id"),a=t.siblings("input.file_name").val();return e.ajax({url:c.renameImg+"?v="+Math.round(100*Math.random()),type:"post",dataType:"json",data:{file_id:n,file_name:a},success:function(e){1==e.status?(t.closest(".albums-edit").children(".img-name-edit").hide(),t.closest(".albums-edit").children("p").html(a),t.closest(".albums-edit").children("input.file_name").val(a),HYD.hint("success","恭喜您，操作成功！")):HYD.hint("danger","对不起，操作失败")}}),!1}),p.on("click",".searchImg",function(){var t=e(this).prev().val();r(p,l.folderID,1,t)})}}(jQuery,document,window),_QV_="%E6%9D%AD%E5%B7%9E%E5%90%AF%E5%8D%9A%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89",HYD.popbox.ImgPicker=function(e){$.albums({callback:e})},$(function(){var e='<span class="autosave-loading"></span>',t='<span class="save-success"><em class="gicon-ok white"></em>已自动保存</span>',n="undefined"!=typeof URL_virChkb&&URL_virChkb.length?URL_virChkb:window.location.href;$(".j-vir-chkb").each(function(){var e=$(this),t=e.find(".vir-chkb-actions"),a=e.find(".vir-chkb-enable"),i=e.find(".vir-chkb-disable"),o=e.find(".j-vir-checkbox"),s=!!o.is(":checked");s?(t.removeClass("disable").addClass("enable"),a.show(),i.hide()):(t.removeClass("enable").addClass("disable"),a.hide(),i.show()),o.change(function(){var e,t=$(this),a=t.attr("name"),i={};e="undefined"==typeof t.data("enableval")?t.is(":checked")?1:0:t.is(":checked")?t.data("enableval"):t.data("disableval"),i.name=a,i.value=e;var o=t.siblings(".j-vir-formdata");o.each(function(){var e=$(this);i[e.data("name")]=e.val()}),$.ajax({url:n+"?v="+Math.round(100*Math.random()),type:"POST",dataType:"json",data:i,success:function(e){1!=e.status&&HYD.hint("danger","对不起，保存失败："+e.msg)}})}),t.show().click(function(){s?(i.show(),t.animate({left:-66},150,function(){a.hide()}),o.attr("checked",!1),s=!1):(a.show(),t.animate({left:0},150,function(){i.hide()}),o.attr("checked",!0),s=!0),o.trigger("change")})}),$(".j-text-autosave,.j-select-autosave").change(function(){var a=$(this),i=a.attr("name"),o=a.val(),s=$(e),l=a.get(0).nextSibling,c=l?$(l):a;$.ajax({url:n+"?v="+Math.round(100*Math.random()),type:"POST",dataType:"json",data:{name:i,value:o},beforeSend:function(){s.insertAfter(c)},success:function(e){s.fadeOut("fast",function(){if($(this).remove(),1==e.status){var n=$(t);n.insertAfter(c).animate({opacity:1},200,function(){setTimeout(function(){n.fadeOut("fast",function(){n.remove()})},1e3)})}else HYD.hint("danger","对不起，保存失败："+e.msg)})}})}),$(".j-radio-autosave").change(function(){var a=$(this),i=a.parents(".form-controls").find(".j-autosavePanel"),o=a.attr("type"),s=a.attr("name"),l=a.val();if("radio"==o){var c=$(e);$.ajax({url:n+"?v="+Math.round(100*Math.random()),type:"POST",dataType:"json",data:{name:s,value:l},beforeSend:function(){i.append(c)},success:function(e){c.fadeOut("fast",function(){if($(this).remove(),1==e.status){var n=$(t);i.append(n),n.animate({opacity:1},200,function(){setTimeout(function(){n.fadeOut("fast",function(){n.remove()})},1e3)})}else HYD.hint("danger","对不起，保存失败："+e.msg)})}})}});var a={};$(".j-checkbox-autosave").each(function(){var i=$(this),o=i.parents(".form-controls").find(".j-autosavePanel"),s=(i.attr("type"),i.attr("name")),l=function(){var a=[];$("input[name='"+s+"']").each(function(){$(this).is(":checked")&&a.push($(this).val())});var i=$(e);$.ajax({url:n+"?v="+Math.round(100*Math.random()),type:"POST",dataType:"json",data:{name:s,value:a},beforeSend:function(){o.append(i)},success:function(e){i.fadeOut("fast",function(){if($(this).remove(),1==e.status){var n=$(t);o.append(n),n.animate({opacity:1},200,function(){setTimeout(function(){n.fadeOut("fast",function(){n.remove()})},1e3)})}else HYD.hint("danger","对不起，保存失败："+e.msg)})}})};a[s]=null,i.change(function(){a[s]&&clearTimeout(a[s]),a[s]=setTimeout(l,800)})}),$(".j-checkbox-autosaves").each(function(){var i=$(this),o=i.parents(".form-controls").find(".j-autosavePanel"),s=(i.attr("type"),i.attr("name")),l=function(){var a=[],a=$("input[name='"+s+"']").val();if(1==a)var i=0;else var i=1;$("input[name='"+s+"']").attr("value",i);var l=$(e);$.ajax({url:n+"?v="+Math.round(100*Math.random()),type:"POST",dataType:"json",data:{name:s,value:a},beforeSend:function(){o.append(l)},success:function(e){l.fadeOut("fast",function(){if($(this).remove(),1==e.status){var n=$(t);o.append(n),n.animate({opacity:1},200,function(){setTimeout(function(){n.fadeOut("fast",function(){n.remove()})},1e3)})}else HYD.hint("danger","对不起，保存失败："+e.msg)})}})};a[s]=null,i.change(function(){a[s]&&clearTimeout(a[s]),a[s]=setTimeout(l,800)})})});